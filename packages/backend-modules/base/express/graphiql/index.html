<!--
 *  Copyright (c) 2021 GraphQL Contributors
 *  All rights reserved.
 *
 *  This source code is licensed under the license found in the
 *  LICENSE file in the root directory of this source tree.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>GraphiQL</title>
  <style>
    body {
      margin: 0;
    }

    #graphiql {
      height: 100dvh;
    }

    .loading {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
  </style>
  <link rel="stylesheet" href="https://esm.sh/graphiql/dist/style.css" />
  <link
    rel="stylesheet"
    href="https://esm.sh/@graphiql/plugin-explorer/dist/style.css"
  />
  <!--
   * Note:
   * The ?standalone flag bundles the module along with all of its `dependencies`, excluding `peerDependencies`, into a single JavaScript file.
   * `@emotion/is-prop-valid` is a shim to remove the console error ` module "@emotion /is-prop-valid" not found`. Upstream issue: https://github.com/motiondivision/motion/issues/3126
  -->
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.1.0",
        "react/": "https://esm.sh/react@19.1.0/",

        "react-dom": "https://esm.sh/react-dom@19.1.0",
        "react-dom/": "https://esm.sh/react-dom@19.1.0/",

        "graphiql": "https://esm.sh/graphiql?standalone&external=react,react-dom,@graphiql/react,graphql",
        "graphiql/": "https://esm.sh/graphiql/",
        "@graphiql/plugin-explorer": "https://esm.sh/@graphiql/plugin-explorer?standalone&external=react,@graphiql/react,graphql",
        "@graphiql/react": "https://esm.sh/@graphiql/react?standalone&external=react,react-dom,graphql,@graphiql/toolkit,@emotion/is-prop-valid",

        "@graphiql/toolkit": "https://esm.sh/@graphiql/toolkit?standalone&external=graphql",
        "graphql": "https://esm.sh/graphql@16.11.0",
        "graphql-ws": "https://esm.sh/graphql-ws@6.0.6",
        "@emotion/is-prop-valid": "data:text/javascript,"
      }
    }
  </script>
  <script type="module">
    import React from 'react';
    import ReactDOM from 'react-dom/client';
    import { GraphiQL, HISTORY_PLUGIN } from 'graphiql';
    import { createGraphiQLFetcher } from '@graphiql/toolkit';
    import { explorerPlugin } from '@graphiql/plugin-explorer';
    import { createClient } from 'graphql-ws';
    import 'graphiql/setup-workers/esm.sh';

    function getQueryFromURL() {
      const url = new URL(window.location.href);
      const query = url.searchParams.get("query");
      return query ? decodeURIComponent(query) : undefined;
    }

    function getVariablesFromURL() {
      const url = new URL(window.location.href);
      const query = url.searchParams.get("variables");
      return query ? decodeURIComponent(query) : undefined;
    }

    const DEFAULT_QUERY = 'query ActiveUser { me { id email } }'

    const websocketURL = [
      window.location.hostname !== 'localhost' ? 'wss' : 'ws',
      '://',
      window.location.origin.replace(window.location.protocol + '//', ''),
      '/graphql',
    ].join('')

    const fetcher = createGraphiQLFetcher({
      url: '/graphql',
      wsClient: createClient({
        url: websocketURL,
      }),
    });
    const plugins = [HISTORY_PLUGIN, explorerPlugin()];

    function App() {
      return React.createElement(GraphiQL, {
        fetcher,
        defaultEditorToolsVisibility: true,
        defaultQuery: getQueryFromURL() || DEFAULT_QUERY,
        initialQuery: getQueryFromURL() || DEFAULT_QUERY,
        initialVariables: getVariablesFromURL(),
        onEditQuery(query) {
          if (query && query !== DEFAULT_QUERY) {
            const url = new URL(window.location.href);
            url.searchParams.set("query", query);
            window.history.replaceState({}, "", url.toString());
            return url.toString();
          }
        },
        onEditVariables(variables) {
          if (variables && variables !== DEFAULT_QUERY) {
            const url = new URL(window.location.href);
            url.searchParams.set("variables", variables);
            window.history.replaceState({}, "", url.toString());
            return url.toString();
          }
        },
      });
    }


    const container = document.getElementById('graphiql');
    const root = ReactDOM.createRoot(container);
    root.render(React.createElement(App));
  </script>
</head>

<body>
  <div id="graphiql">
    <div class="loading">Loadingâ€¦</div>
  </div>
</body>

</html>
